# Проект: Сайт продажи дилерских автомобилей
## Гулис Антон Александрович 
## 253505

## Информация о проекте
В данном проекте разрабатывается сайт, позволяющий пользователям покупать автомобили, а дилерам размещать свои. Проект будет включать функции управления пользователями, автомобилями и заказами.

## Гулис Антон Александрович

## 253505

## Функциональные требования
1. **Регистрация и авторизация пользователей**
Пользователь может зарегистрироваться, указав имя, фамилию, email и пароль.
Пользователь может авторизоваться с помощью email и пароля.
Администратор может создавать пользователей с различными ролями (например, клиент, дилер, администратор).
Пол**ьзователь может изменить свои данные (имя, фамилию, пароль).
2. **Роли и права доступа**
Администратор может создавать и управлять ролями пользователей.
В зависимости от роли, пользователи имеют разный уровень доступа:
Клиенты могут просматривать автомобили, делать заказы, оставлять отзывы.
Дилеры могут добавлять автомобили, редактировать и удалять свои предложения.
Администраторы могут управлять всеми пользователями, дилерами и автомобилями.
3. **Каталог автомобилей**
Пользователь может просматривать список автомобилей с возможностью фильтрации по марке, модели, цене и году выпуска.
Для каждого автомобиля отображаются его детали: марка, модель, год выпуска, цена, изображения.
Дилер может добавлять новые автомобили в каталог.
Дилер может редактировать и удалять информацию о своих автомобилях.
4. **Заказы и продажи**
Пользователь может оформить заказ на автомобиль.
После оформления заказа генерируется запись с датой заказа и данными пользователя.
Администратор и дилер могут просматривать список заказов.
Продажа автомобиля фиксируется в базе данных после подтверждения заказа, создавая запись о продаже.
5. **Отзывы и рейтинги**
Пользователь может оставить отзыв и поставить рейтинг автомобилю.
Рейтинг может быть от 1 до 5 звезд.
Отзывы отображаются на странице автомобиля и могут быть просмотрены всеми пользователями.
Администратор может удалять неуместные отзывы.
6. **История действий (логирование)**
Записываются все действия пользователей (авторизация, добавление автомобиля, создание заказа и т.д.).
Администратор может просматривать журнал действий.
7. **Фильтрация и поиск автомобилей**
Пользователь может фильтровать автомобили по цене, марке, модели, году выпуска и другим критериям.
Пользователь может сохранять свои фильтры для повторного использования.
8. **Изображения автомобилей**
Дилер может загружать изображения для автомобилей.
Для каждого автомобиля может быть загружено несколько изображений, которые отображаются в его карточке.
9. **Управление профилем дилеров**
Дилеры могут управлять своим профилем, включая возможность редактировать личные данные.
Администратор может назначать роли "дилер" существующим пользователям.
10. **Управление заказами**
Клиенты могут просматривать статус своих заказов.
Дилеры могут управлять статусом заказа (например, подтвердить или отменить заказ).
11. **Администрирование**
Администратор имеет доступ к управлению всеми данными (пользователи, дилеры, автомобили, заказы, отзывы).

## Перечень сущностей БД
```
CREATE TABLE users (
  id SERIAL PRIMARY KEY,                 -- Уникальный идентификатор пользователя
  first_name VARCHAR(64),                -- Имя пользователя
  last_name VARCHAR(64),                 -- Фамилия пользователя
  email VARCHAR(100) UNIQUE,             -- Электронная почта (уникальная)
  password VARCHAR(30),                  -- Пароль пользователя
  basket_id INTEGER REFERENCES baskets(id),  -- Ссылка на корзину пользователя
  role_id INTEGER REFERENCES roles(id),  -- Ссылка на роль пользователя
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP  -- Дата создания пользователя
);

-- Таблица ролей
CREATE TABLE roles (
  id SERIAL PRIMARY KEY,                -- Уникальный идентификатор роли
  role_name VARCHAR(30) NOT NULL DEFAULT 'user'  -- Название роли (по умолчанию 'user')
);

-- Таблица автомобилей
CREATE TABLE cars (
  id SERIAL PRIMARY KEY,                -- Уникальный идентификатор автомобиля
  brand VARCHAR(50),                    -- Бренд автомобиля
  model VARCHAR(100),                   -- Модель автомобиля
  year INTEGER,                         -- Год выпуска
  price DECIMAL(19, 2)                  -- Цена автомобиля
);

-- Таблица заказов
CREATE TABLE orders (
  id SERIAL PRIMARY KEY,                -- Уникальный идентификатор заказа
  user_id INTEGER REFERENCES users(id), -- Ссылка на пользователя, сделавшего заказ
  order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- Дата заказа
  price DECIMAL(19, 2)                  -- Цена заказа
);

-- Таблица элементов заказа
CREATE TABLE order_items (
  id SERIAL PRIMARY KEY,                -- Уникальный идентификатор элемента заказа
  car_id INTEGER REFERENCES cars(id),   -- Ссылка на автомобиль
  order_id INTEGER REFERENCES orders(id),  -- Ссылка на заказ
  amount INTEGER NOT NULL DEFAULT 1     -- Количество единиц товара (по умолчанию 1)
);

-- Таблица корзин
CREATE TABLE baskets (
  id SERIAL PRIMARY KEY,                -- Уникальный идентификатор корзины
  user_id INTEGER REFERENCES users(id)  -- Ссылка на пользователя, владеющего корзиной
);

-- Таблица элементов корзины
CREATE TABLE basket_items (
  id SERIAL PRIMARY KEY,                -- Уникальный идентификатор элемента корзины
  car_id INTEGER REFERENCES cars(id),   -- Ссылка на автомобиль
  basket_id INTEGER REFERENCES baskets(id),  -- Ссылка на корзину
  amount INTEGER NOT NULL DEFAULT 1     -- Количество единиц товара (по умолчанию 1)
);

-- Таблица отзывов
CREATE TABLE reviews (
  id SERIAL PRIMARY KEY,                -- Уникальный идентификатор отзыва
  car_id INTEGER REFERENCES cars(id),   -- Ссылка на автомобиль
  user_id INTEGER REFERENCES users(id), -- Ссылка на пользователя, оставившего отзыв
  rating INTEGER NOT NULL,              -- Оценка отзыва
  comment TEXT                          -- Текст отзыва
);

-- Таблица логов действий
CREATE TABLE logs (
  id SERIAL PRIMARY KEY,                -- Уникальный идентификатор лога
  user_id INTEGER REFERENCES users(id), -- Ссылка на пользователя
  action VARCHAR(15),                   -- Действие пользователя
  timestamp TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP  -- Время выполнения действия
);

-- Таблица изображений
CREATE TABLE images (
  id SERIAL PRIMARY KEY,                -- Уникальный идентификатор изображения
  car_id INTEGER REFERENCES cars(id),   -- Ссылка на автомобиль
  image_url VARCHAR(30)                 -- URL изображения автомобиля
);
```

## Связи между сущностями
- Пользователи и их роли: связь между таблицами users и roles через role_id (1:M).
- Корзины и пользователи: связь между таблицами baskets и users через user_id (1:1).
- Заказы и пользователи: связь между таблицами orders и users через user_id (1:M).
- Элементы заказа и автомобили: связь между таблицами order_items и cars (M:M).
- Отзывы и автомобили/пользователи: связь между таблицами reviews и cars, а также reviews и users (1:M).
- Логи и пользователи: связь между таблицами logs и users (1:M).
- Изображения и автомобили: связь между таблицами images и cars (1:M).

## Схема БД
![image](db.png)
